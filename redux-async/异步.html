<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script src="./redux.min.js"></script>
<script>

    let users = [
        {
            id: 1,
            username: 'zs',
            age: 35
        },
        {
            id: 2,
            username: 'ls',
            age: 30
        }
    ];


    function reducer(state, action) {

        switch (action.type) {
            case 'ADD':
                return [...state, action.payload];
            default:
                return state;
        }

    }

    let store = Redux.createStore( reducer, users );


    function add(payload) {
        return new Promise(resolve => {
            setTimeout(() => {
                resolve( {
                    type: 'ADD',
                    payload
                })
            }, 1000);
        })
    }

    // 先将原有的store.dispatch存起来，再重写！
    let dispatch = store.dispatch;


    // 把它重写
    store.dispatch = function(reducer) {
        reducer.then( val => {
            console.log(val);
            // 处理完then后再调用原生dispatch
            dispatch(val);
        } );
    };

    store.dispatch( add('abc') );
    console.log( store.getState() );


</script>
</body>
</html>